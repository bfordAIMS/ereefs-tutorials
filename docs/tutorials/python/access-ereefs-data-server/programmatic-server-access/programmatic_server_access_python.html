<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.217">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>eReefs tutorials - Access eReefs data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../images/logo.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-sm navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../images/ereefs_aims_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">eReefs tutorials</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://www.r-project.org/" rel="" target="">
 <span class="menu-text"><i class="fa-brands fa-r-project" aria-label="r-project"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.python.org/" rel="" target="">
 <span class="menu-text"><i class="fa-brands fa-python" aria-label="python"></i> python</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text">   </span></li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/bfordAIMS/ereefs-tutorials" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#python-modules" id="toc-python-modules" class="nav-link active" data-scroll-target="#python-modules">Python modules</a></li>
  <li><a href="#motivating-problem" id="toc-motivating-problem" class="nav-link" data-scroll-target="#motivating-problem">Motivating problem</a></li>
  <li><a href="#example-tracking-data" id="toc-example-tracking-data" class="nav-link" data-scroll-target="#example-tracking-data">Example tracking data</a></li>
  <li><a href="#extracting-data-from-the-server" id="toc-extracting-data-from-the-server" class="nav-link" data-scroll-target="#extracting-data-from-the-server">Extracting data from the server</a></li>
  <li><a href="#matching-extracted-data-to-tracking-data" id="toc-matching-extracted-data-to-tracking-data" class="nav-link" data-scroll-target="#matching-extracted-data-to-tracking-data">Matching extracted data to tracking data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Access eReefs data</h1>
<p class="subtitle lead">Programmatic server access <i class="fa-brands fa-python" aria-label="python"></i></p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="tutorial-description">
<p>Learn how to extract eReefs data from the AIMS server for multiple dates and points with OPeNDAP in <i class="fa-brands fa-python" aria-label="python"></i> python.</p>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This tutorial builds on the techniques introduced in <a href="../../../../tutorials/python/access-ereefs-data-server/basic-server-access/basic_server_access_python.html">Access eReefs data: Basic server access <i class="fa-brands fa-python" aria-label="python"></i></a>.</p>
</div>
</div>
</div>
<p>In this tutorial we will look at how to get eReefs data from the <a href="http://thredds.ereefs.aims.gov.au/thredds/catalog.html">AIMS server</a> corresponding to the logged locations of tagged marine animals. Keep in mind, however, that the same methodology can be applied in any situation where we wish to extract eReefs data for a range of points with different dates of interest for each point.</p>
<section id="python-modules" class="level2">
<h2 class="anchored" data-anchor-id="python-modules">Python modules</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd  <span class="co"># for data analysis</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># for quik maths</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> janitor <span class="im">import</span> clean_names  <span class="co"># to create consitent, 'clean' variable names</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium  <span class="co"># a python API to interactive leaflet maps</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt <span class="co"># to time how long the data export takes</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML <span class="co"># to render, i.e. 'display', html tables</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> netCDF4 <span class="im">import</span> Dataset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="motivating-problem" class="level2">
<h2 class="anchored" data-anchor-id="motivating-problem">Motivating problem</h2>
<p>The tracking of marine animals is commonly used by researchers to gain insights into the distribution, biology, behaviour and ecology of different species. However, knowing where an animal was at a certain point in time is only one piece of the puzzle. To start to understand <em>why</em> an animal was where it was, we usually require information on things like: What type of habitat is present at the location? What were the environmental conditions like at the time? What other lifeforms were present at the tracked location (e.g.&nbsp;for food or mating)?</p>
<p>In this tutorial we will pretend that we have tracking data for Loggerhead Sea Turtles and wish to get eReefs data corresponding to the tracked points (in time and space) to understand more about the likely environmental conditions experienced by our turtles.</p>
<details>
<summary>
Read more: Tracking marine animals
</summary>
<p>Marine animals are typically tracked using either acoustic or satellite tags. These tags are attached to the animals and transmit signals back to recievers, logging the animal’s location at different points in time. In some cases other data such as depth, temperature, and animal movement profiles are recorded and the data transmitted to the recievers whenever possible.</p>
<p>Acoustic tracking requires a network of recievers to be placed in the ocean in order to pick up the tags’ transmitted signals when they come within range (typically around 500 m). Acoustic tracking has the advantage of being able transmit and recieve signals underwater, however is limited by the coverage of the reciever network. In some instances, researchers do without the reciever network and follow the animals around in a boat to receive the data. The suitability of acoustic tracking depends on the study species and research question.</p>
<p>Satellite tracking, on the other hand, is able to track animals over virtually the entire ocean as the tags transmit signals to a network of satellites orbiting the earth. However, unlike acoustic tags, the signals cannot be transmitted through water and the tagged animals must breach the ocean surface in order to have their location logged and any other recorded data be received. The accuracy of the logged location depends on the quality of the transmitted signal. For high-quality signals, the location uncertainty can be in the hundreds of metres, however for bad quality signals this can blow out to over 10 km.</p>
</details>
</section>
<section id="example-tracking-data" class="level2">
<h2 class="anchored" data-anchor-id="example-tracking-data">Example tracking data</h2>
<p>We will use satellite tracking data for Loggerhead Sea Turtles (<em>Caretta caretta</em>) provided in <a href="https://doi.org/10.15468/k4s6ap">Strydom (2022)</a>. This data contains tracking detections which span the length of the Great Barrier Reef off the east coast of Queensland Australia from December 2021 to April 2022 (shown in <a href="#fig-data-map">Figure&nbsp;1</a>).</p>
<div class="callout callout-style-simple callout-caution">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This dataset is a summarized representation of the tracking locations per 1-degree cell. This implies a coordinate uncertainty of roughly 110 km. This level of uncertainty renders the data virtually useless for most practical applications, though it will suffice for the purposes of this tutorial. Records which are landbased as a result of the uncertainty have been removed and from here on in we will just pretend that the coordinates are accurate.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">"data/Loggerhead_Sea_Turtle_satellite_tracking_detections__Strydom_2022_DOI10-15468-k4s6ap.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns names from camelCase to snake_case</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.clean_names(case_type <span class="op">=</span> <span class="st">"snake"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename some variables for easier use</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.rename(columns <span class="op">=</span> {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gbif_id"</span>: <span class="st">"record_id"</span>, </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"decimal_latitude"</span>: <span class="st">"latitude"</span>, </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"decimal_longitude"</span>: <span class="st">"longitude"</span>, </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"event_date"</span>: <span class="st">"date_time"</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure date_time is in the datetime data format</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'date_time'</span>] <span class="op">=</span> pd.to_datetime(data[<span class="st">'date_time'</span>])</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Seperate date_time into date and time variables</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.assign(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  date <span class="op">=</span> data[<span class="st">'date_time'</span>].dt.strftime(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>), </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  time <span class="op">=</span> data[<span class="st">'date_time'</span>].dt.strftime(<span class="st">"%H:%M"</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove land based records (as a result of coordinate uncertainty)</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>land_based_records <span class="op">=</span> [<span class="dv">4022992331</span>, <span class="dv">4022992326</span>, <span class="dv">4022992312</span>, <span class="dv">4022992315</span>, <span class="dv">4022992322</span>, <span class="dv">4022992306</span>]</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.query(<span class="st">"record_id not in @land_based_records"</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the variables relevant to this tutorial</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>select_vars <span class="op">=</span> [<span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="st">"date"</span>, <span class="st">"time"</span>, <span class="st">"date_time"</span>,<span class="st">"record_id"</span>, <span class="st">"species"</span>]</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[select_vars]</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># View the tracking locations on an interactive map:</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map centred on the mean coordinates of the tracking locations</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>centre_point <span class="op">=</span> [data[<span class="st">'latitude'</span>].mean(), data[<span class="st">'longitude'</span>].mean()]</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>track_map <span class="op">=</span> folium.Map(location <span class="op">=</span> centre_point, zoom_start <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Add markers to map at each tracking location</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> data.itertuples():</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  coords_i <span class="op">=</span> [row.latitude, row.longitude]</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  marker_i <span class="op">=</span> folium.Marker(location <span class="op">=</span> coords_i, popup <span class="op">=</span> row.date_time)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  marker_i.add_to(track_map)<span class="op">;</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: the trailing ';' above supresses the output of the add marker function (which returns a pointer to the marker in memory)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;folium.map.Marker object at 0x00000276FB363670&gt;
&lt;folium.map.Marker object at 0x00000276FB3638B0&gt;
&lt;folium.map.Marker object at 0x00000276FB363970&gt;
&lt;folium.map.Marker object at 0x00000276FB363520&gt;
&lt;folium.map.Marker object at 0x00000276FB3609D0&gt;
&lt;folium.map.Marker object at 0x00000276FB3632E0&gt;
&lt;folium.map.Marker object at 0x00000276FB361B10&gt;
&lt;folium.map.Marker object at 0x00000276FB3603A0&gt;
&lt;folium.map.Marker object at 0x00000276FB3606A0&gt;
&lt;folium.map.Marker object at 0x00000276FB360130&gt;
&lt;folium.map.Marker object at 0x00000276FB361810&gt;
&lt;folium.map.Marker object at 0x00000276FB360E50&gt;
&lt;folium.map.Marker object at 0x00000276FB3605B0&gt;
&lt;folium.map.Marker object at 0x00000276FB3BD660&gt;
&lt;folium.map.Marker object at 0x00000276FB3BD900&gt;
&lt;folium.map.Marker object at 0x00000276FB3BD030&gt;
&lt;folium.map.Marker object at 0x00000276FB3BD3F0&gt;
&lt;folium.map.Marker object at 0x00000276FB3BD7B0&gt;
&lt;folium.map.Marker object at 0x00000276FB3BD9F0&gt;
&lt;folium.map.Marker object at 0x00000276FB3BEDD0&gt;
&lt;folium.map.Marker object at 0x00000276FB3BDC60&gt;
&lt;folium.map.Marker object at 0x00000276FB3BD8D0&gt;
&lt;folium.map.Marker object at 0x00000276FB3BE680&gt;
&lt;folium.map.Marker object at 0x00000276FB3BCFA0&gt;
&lt;folium.map.Marker object at 0x00000276FB3BD300&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>track_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-data-map" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -&gt; Trust Notebook</span><iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-1.12.4.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_a52d74270167b75bb18b615b72498562 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
</head>
<body>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_a52d74270167b75bb18b615b72498562&quot; ></div>
        
</body>
<script>
    
    
            var map_a52d74270167b75bb18b615b72498562 = L.map(
                &quot;map_a52d74270167b75bb18b615b72498562&quot;,
                {
                    center: [-18.74, 148.42],
                    crs: L.CRS.EPSG3857,
                    zoom: 4,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_2e396be942f6edeea2dcc10eec721239 = L.tileLayer(
                &quot;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;Data by \u0026copy; \u003ca target=\&quot;_blank\&quot; href=\&quot;http://openstreetmap.org\&quot;\u003eOpenStreetMap\u003c/a\u003e, under \u003ca target=\&quot;_blank\&quot; href=\&quot;http://www.openstreetmap.org/copyright\&quot;\u003eODbL\u003c/a\u003e.&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 18, &quot;maxZoom&quot;: 18, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
            var marker_8adf2b07db6ac80d86a51f4870daf2fb = L.marker(
                [-20.5, 150.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_e8d03e1481411bbc0c92bc9106d56f71 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_6b339f7f739c0fe4c68685d509f5706c = $(`<div id=&quot;html_6b339f7f739c0fe4c68685d509f5706c&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-17 17:06:32+00:00</div>`)[0];
                popup_e8d03e1481411bbc0c92bc9106d56f71.setContent(html_6b339f7f739c0fe4c68685d509f5706c);
            
        

        marker_8adf2b07db6ac80d86a51f4870daf2fb.bindPopup(popup_e8d03e1481411bbc0c92bc9106d56f71)
        ;

        
    
    
            var marker_66d77f229d214e9a50bb99b5a2a541d7 = L.marker(
                [-25.5, 153.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_9fa5db0d3050805d43076f56471846bf = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_38a769e964fdff3eacb5cd9bc0c3cbae = $(`<div id=&quot;html_38a769e964fdff3eacb5cd9bc0c3cbae&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-02 21:49:55+00:00</div>`)[0];
                popup_9fa5db0d3050805d43076f56471846bf.setContent(html_38a769e964fdff3eacb5cd9bc0c3cbae);
            
        

        marker_66d77f229d214e9a50bb99b5a2a541d7.bindPopup(popup_9fa5db0d3050805d43076f56471846bf)
        ;

        
    
    
            var marker_e99e23708ede7655e8bb89f98950c1d2 = L.marker(
                [-24.5, 152.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_de0617209588fc9f8e75653fe0ed894f = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_2dcc9f2cbf34962f645521c23c8f5161 = $(`<div id=&quot;html_2dcc9f2cbf34962f645521c23c8f5161&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2021-12-21 17:57:22+00:00</div>`)[0];
                popup_de0617209588fc9f8e75653fe0ed894f.setContent(html_2dcc9f2cbf34962f645521c23c8f5161);
            
        

        marker_e99e23708ede7655e8bb89f98950c1d2.bindPopup(popup_de0617209588fc9f8e75653fe0ed894f)
        ;

        
    
    
            var marker_bc1bc1cae466c89cb4ad409e9284e280 = L.marker(
                [-18.5, 147.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_119fb1330faefeb84d2aa54d4f77817b = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_962fb834e4497c285fdcf2f12b89175e = $(`<div id=&quot;html_962fb834e4497c285fdcf2f12b89175e&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-27 17:00:04+00:00</div>`)[0];
                popup_119fb1330faefeb84d2aa54d4f77817b.setContent(html_962fb834e4497c285fdcf2f12b89175e);
            
        

        marker_bc1bc1cae466c89cb4ad409e9284e280.bindPopup(popup_119fb1330faefeb84d2aa54d4f77817b)
        ;

        
    
    
            var marker_a4decb71e43c6448eff25d21cd4cd1cd = L.marker(
                [-14.5, 145.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_01c4750b67ee6c6bc1c21d9bb2cb2844 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_7ecc98563ff98d1daec7af81ff6c4df9 = $(`<div id=&quot;html_7ecc98563ff98d1daec7af81ff6c4df9&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-02-12 10:34:12+00:00</div>`)[0];
                popup_01c4750b67ee6c6bc1c21d9bb2cb2844.setContent(html_7ecc98563ff98d1daec7af81ff6c4df9);
            
        

        marker_a4decb71e43c6448eff25d21cd4cd1cd.bindPopup(popup_01c4750b67ee6c6bc1c21d9bb2cb2844)
        ;

        
    
    
            var marker_5383f81ff1303182ee5ae3fff693c512 = L.marker(
                [-26.5, 153.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_d33317bf38d653975e606886294fba3b = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_6b02223d6ba415de0d9182b2d28875cc = $(`<div id=&quot;html_6b02223d6ba415de0d9182b2d28875cc&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-02-12 08:59:01+00:00</div>`)[0];
                popup_d33317bf38d653975e606886294fba3b.setContent(html_6b02223d6ba415de0d9182b2d28875cc);
            
        

        marker_5383f81ff1303182ee5ae3fff693c512.bindPopup(popup_d33317bf38d653975e606886294fba3b)
        ;

        
    
    
            var marker_f4d0dbfb04b274359f39b86591c16530 = L.marker(
                [-19.5, 148.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_899b2381ab6d7e7b073c47f1d7c815a7 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_5ca4c340ceaaa59362400352ed839f25 = $(`<div id=&quot;html_5ca4c340ceaaa59362400352ed839f25&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-23 07:02:18+00:00</div>`)[0];
                popup_899b2381ab6d7e7b073c47f1d7c815a7.setContent(html_5ca4c340ceaaa59362400352ed839f25);
            
        

        marker_f4d0dbfb04b274359f39b86591c16530.bindPopup(popup_899b2381ab6d7e7b073c47f1d7c815a7)
        ;

        
    
    
            var marker_769505d1e4852bebc8f6e4df8763d2d1 = L.marker(
                [-10.5, 143.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_90d48a8e0fb5d027f0c233fd94fdec5c = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_c8eaf3b3af4cc1e8f669b48b46539fc8 = $(`<div id=&quot;html_c8eaf3b3af4cc1e8f669b48b46539fc8&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-04-14 06:31:48+00:00</div>`)[0];
                popup_90d48a8e0fb5d027f0c233fd94fdec5c.setContent(html_c8eaf3b3af4cc1e8f669b48b46539fc8);
            
        

        marker_769505d1e4852bebc8f6e4df8763d2d1.bindPopup(popup_90d48a8e0fb5d027f0c233fd94fdec5c)
        ;

        
    
    
            var marker_49691cdf2755dfe219dd83ceff2a9ff8 = L.marker(
                [-20.5, 149.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_6ce9d5f719b001ac6e2e5e1d381e510f = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_7cbea0459b8665354e41d9a08577a6dd = $(`<div id=&quot;html_7cbea0459b8665354e41d9a08577a6dd&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-19 17:44:38+00:00</div>`)[0];
                popup_6ce9d5f719b001ac6e2e5e1d381e510f.setContent(html_7cbea0459b8665354e41d9a08577a6dd);
            
        

        marker_49691cdf2755dfe219dd83ceff2a9ff8.bindPopup(popup_6ce9d5f719b001ac6e2e5e1d381e510f)
        ;

        
    
    
            var marker_a20857fb77e328ba64f6d37018725348 = L.marker(
                [-22.5, 151.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_60b2beed317d33d243fc019f79eb5d18 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_21452b083529abb9be07a1857e92f374 = $(`<div id=&quot;html_21452b083529abb9be07a1857e92f374&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-09 20:25:01+00:00</div>`)[0];
                popup_60b2beed317d33d243fc019f79eb5d18.setContent(html_21452b083529abb9be07a1857e92f374);
            
        

        marker_a20857fb77e328ba64f6d37018725348.bindPopup(popup_60b2beed317d33d243fc019f79eb5d18)
        ;

        
    
    
            var marker_d7f863740b6e318f423c8a9785e44f37 = L.marker(
                [-21.5, 150.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_57d3e3c18a778926aa0a14657ca44704 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_2357a369421e3ac6f3639a99f1e021e2 = $(`<div id=&quot;html_2357a369421e3ac6f3639a99f1e021e2&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-14 18:26:17+00:00</div>`)[0];
                popup_57d3e3c18a778926aa0a14657ca44704.setContent(html_2357a369421e3ac6f3639a99f1e021e2);
            
        

        marker_d7f863740b6e318f423c8a9785e44f37.bindPopup(popup_57d3e3c18a778926aa0a14657ca44704)
        ;

        
    
    
            var marker_0b5bc602f59710cbcbd7334e65638cba = L.marker(
                [-11.5, 143.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_9864ece9cc162d6f7ea35cea4becd04d = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_0238c1d67460466f1aa3df2cad285f69 = $(`<div id=&quot;html_0238c1d67460466f1aa3df2cad285f69&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-04-09 22:00:54+00:00</div>`)[0];
                popup_9864ece9cc162d6f7ea35cea4becd04d.setContent(html_0238c1d67460466f1aa3df2cad285f69);
            
        

        marker_0b5bc602f59710cbcbd7334e65638cba.bindPopup(popup_9864ece9cc162d6f7ea35cea4becd04d)
        ;

        
    
    
            var marker_704ad7f706b388bcbe8fc486eac6b606 = L.marker(
                [-19.5, 149.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_e3203bd7c2418070a614fa33f07bd37c = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_9fda2c7dcf6c00664cd5aa127fea6cee = $(`<div id=&quot;html_9fda2c7dcf6c00664cd5aa127fea6cee&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-21 07:22:08+00:00</div>`)[0];
                popup_e3203bd7c2418070a614fa33f07bd37c.setContent(html_9fda2c7dcf6c00664cd5aa127fea6cee);
            
        

        marker_704ad7f706b388bcbe8fc486eac6b606.bindPopup(popup_e3203bd7c2418070a614fa33f07bd37c)
        ;

        
    
    
            var marker_750d2c1d7743c06b2a9a96f4bcc72f2b = L.marker(
                [-18.5, 146.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_0a6e48fa7b0fd88c173c44a025c5df80 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_7ab921bbeed285c4102340b0926ebf54 = $(`<div id=&quot;html_7ab921bbeed285c4102340b0926ebf54&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-30 17:02:42+00:00</div>`)[0];
                popup_0a6e48fa7b0fd88c173c44a025c5df80.setContent(html_7ab921bbeed285c4102340b0926ebf54);
            
        

        marker_750d2c1d7743c06b2a9a96f4bcc72f2b.bindPopup(popup_0a6e48fa7b0fd88c173c44a025c5df80)
        ;

        
    
    
            var marker_dfab33b759aa102ddd7da1b1d6dc0002 = L.marker(
                [-24.5, 153.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_98ddaaf585b7e570c0decb9138a5521d = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_cf6a2c703427cb670b892ccc4e2e2792 = $(`<div id=&quot;html_cf6a2c703427cb670b892ccc4e2e2792&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-02-03 21:37:56+00:00</div>`)[0];
                popup_98ddaaf585b7e570c0decb9138a5521d.setContent(html_cf6a2c703427cb670b892ccc4e2e2792);
            
        

        marker_dfab33b759aa102ddd7da1b1d6dc0002.bindPopup(popup_98ddaaf585b7e570c0decb9138a5521d)
        ;

        
    
    
            var marker_4756f5a6a8bf8e843d92d8aeb4c9ecd1 = L.marker(
                [-15.5, 145.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_7fde9d1dc6543e69ea97c9d275f78ad2 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_3980b58094023999920d4c21016b4442 = $(`<div id=&quot;html_3980b58094023999920d4c21016b4442&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-02-09 18:33:03+00:00</div>`)[0];
                popup_7fde9d1dc6543e69ea97c9d275f78ad2.setContent(html_3980b58094023999920d4c21016b4442);
            
        

        marker_4756f5a6a8bf8e843d92d8aeb4c9ecd1.bindPopup(popup_7fde9d1dc6543e69ea97c9d275f78ad2)
        ;

        
    
    
            var marker_536605c87a6bd24c498cf0ab6e0486c8 = L.marker(
                [-16.5, 145.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_3a2b1306b7a920844bace687c8b9284a = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_66c9a5e2e8ac2c10b286bb3b94628ce1 = $(`<div id=&quot;html_66c9a5e2e8ac2c10b286bb3b94628ce1&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-02-07 07:15:30+00:00</div>`)[0];
                popup_3a2b1306b7a920844bace687c8b9284a.setContent(html_66c9a5e2e8ac2c10b286bb3b94628ce1);
            
        

        marker_536605c87a6bd24c498cf0ab6e0486c8.bindPopup(popup_3a2b1306b7a920844bace687c8b9284a)
        ;

        
    
    
            var marker_d76ee6281df7f43fb08ba67128770b06 = L.marker(
                [-13.5, 144.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_34775c2266729c6af181959cb0db0b65 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_3f34588a7f2ad2b192c1cd7992c802ee = $(`<div id=&quot;html_3f34588a7f2ad2b192c1cd7992c802ee&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-03-25 07:10:49+00:00</div>`)[0];
                popup_34775c2266729c6af181959cb0db0b65.setContent(html_3f34588a7f2ad2b192c1cd7992c802ee);
            
        

        marker_d76ee6281df7f43fb08ba67128770b06.bindPopup(popup_34775c2266729c6af181959cb0db0b65)
        ;

        
    
    
            var marker_7989937ade30aff07359f5b0ae51c26f = L.marker(
                [-21.5, 151.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_1591006bb8cf101ea6cce153781d3cbb = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_1ec8f439fa1aaacc24a3679c44b160e1 = $(`<div id=&quot;html_1ec8f439fa1aaacc24a3679c44b160e1&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-13 06:28:09+00:00</div>`)[0];
                popup_1591006bb8cf101ea6cce153781d3cbb.setContent(html_1ec8f439fa1aaacc24a3679c44b160e1);
            
        

        marker_7989937ade30aff07359f5b0ae51c26f.bindPopup(popup_1591006bb8cf101ea6cce153781d3cbb)
        ;

        
    
    
            var marker_a158ada2efa125d08a490cb830347a04 = L.marker(
                [-12.5, 143.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_39c08f744b0b7933f496e9e3689c8f4c = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_15b4a560b0e7263eff12199df3d068d3 = $(`<div id=&quot;html_15b4a560b0e7263eff12199df3d068d3&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-04-01 18:41:42+00:00</div>`)[0];
                popup_39c08f744b0b7933f496e9e3689c8f4c.setContent(html_15b4a560b0e7263eff12199df3d068d3);
            
        

        marker_a158ada2efa125d08a490cb830347a04.bindPopup(popup_39c08f744b0b7933f496e9e3689c8f4c)
        ;

        
    
    
            var marker_e97d07e69aee4e6cb61a90d50a033fc1 = L.marker(
                [-9.5, 143.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_9a05c35cc8cc966e7766e9812d408478 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_452950bf6b28e02f347f72d42b849aec = $(`<div id=&quot;html_452950bf6b28e02f347f72d42b849aec&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-04-21 10:30:09+00:00</div>`)[0];
                popup_9a05c35cc8cc966e7766e9812d408478.setContent(html_452950bf6b28e02f347f72d42b849aec);
            
        

        marker_e97d07e69aee4e6cb61a90d50a033fc1.bindPopup(popup_9a05c35cc8cc966e7766e9812d408478)
        ;

        
    
    
            var marker_a104c690c5b46fe0b6e1877892360d1a = L.marker(
                [-23.5, 152.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_f4659e0d164de38c98f41883a360b414 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_b66cc0a2ba979732a6ae999c5f64221e = $(`<div id=&quot;html_b66cc0a2ba979732a6ae999c5f64221e&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-05 07:33:53+00:00</div>`)[0];
                popup_f4659e0d164de38c98f41883a360b414.setContent(html_b66cc0a2ba979732a6ae999c5f64221e);
            
        

        marker_a104c690c5b46fe0b6e1877892360d1a.bindPopup(popup_f4659e0d164de38c98f41883a360b414)
        ;

        
    
    
            var marker_56ca2938cd36f97b1b17fb73e70fce8b = L.marker(
                [-16.5, 146.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_0e664ce5b8513c16fa16e0c99f4bdd7e = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_8dfa3bec6dbdcaae4bea677d690f2cd0 = $(`<div id=&quot;html_8dfa3bec6dbdcaae4bea677d690f2cd0&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-02-06 18:25:38+00:00</div>`)[0];
                popup_0e664ce5b8513c16fa16e0c99f4bdd7e.setContent(html_8dfa3bec6dbdcaae4bea677d690f2cd0);
            
        

        marker_56ca2938cd36f97b1b17fb73e70fce8b.bindPopup(popup_0e664ce5b8513c16fa16e0c99f4bdd7e)
        ;

        
    
    
            var marker_397be8507503ae436929bc1d06aa6228 = L.marker(
                [-23.5, 151.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_8224363be1fb0419ec378370ecc28a8e = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_79838a2b1ac26603d068e14449b2ed83 = $(`<div id=&quot;html_79838a2b1ac26603d068e14449b2ed83&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-01-06 05:03:23+00:00</div>`)[0];
                popup_8224363be1fb0419ec378370ecc28a8e.setContent(html_79838a2b1ac26603d068e14449b2ed83);
            
        

        marker_397be8507503ae436929bc1d06aa6228.bindPopup(popup_8224363be1fb0419ec378370ecc28a8e)
        ;

        
    
    
            var marker_bbaf3a6ec4cb8e1bc72e8ea974b1b725 = L.marker(
                [-17.5, 146.5],
                {}
            ).addTo(map_a52d74270167b75bb18b615b72498562);
        
    
        var popup_b3903aa72c4822e991dad0c4a5780b22 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_c1f7cefc2f72ce8abb7a4cf118f708e8 = $(`<div id=&quot;html_c1f7cefc2f72ce8abb7a4cf118f708e8&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;>2022-02-02 09:14:56+00:00</div>`)[0];
                popup_b3903aa72c4822e991dad0c4a5780b22.setContent(html_c1f7cefc2f72ce8abb7a4cf118f708e8);
            
        

        marker_bbaf3a6ec4cb8e1bc72e8ea974b1b725.bindPopup(popup_b3903aa72c4822e991dad0c4a5780b22)
        ;

        
    
</script>
</html>" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen=""></iframe></div></div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Loggerhead Sea Turtle satellite tracking records (December 2021 - April 2022)</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="extracting-data-from-the-server" class="level2">
<h2 class="anchored" data-anchor-id="extracting-data-from-the-server">Extracting data from the server</h2>
<p>In the preceeding tutorial <a href="../../../../tutorials/python/access-ereefs-data-server/basic-server-access/basic_server_access_python.html">Accessing eReefs data from the AIMS server</a> we introduced the process of extracting eReefs data from the <a href="http://thredds.ereefs.aims.gov.au/thredds/catalog.html">AIMS server</a>. We will now extend this methodology to extract data for a set of points and dates.</p>
<p>In <a href="#tbl-detections">Table&nbsp;1</a> below we see the set of coordinates and dates for which we wish to get the eReefs data.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The AIMS eReefs server only contains aggregated data. That is daily, monthly, or yearly aggregations of the hourly eReefs raw model output. We will use the daily aggregated data for this tutorial, however the same techniques could be applied to access the raw model data from the <a href="https://dapds00.nci.org.au/thredds/catalogs/fx3/catalog.html">National Computational Infrastructure (NCI) server</a>.</p>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Show code to produce table</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create table of tracking detections</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>tbl <span class="op">=</span> data.sort_values(<span class="st">'date_time'</span>) <span class="co"># sort by date_time</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>tbl <span class="op">=</span> tbl[[<span class="st">'date'</span>, <span class="st">'time'</span>, <span class="st">'longitude'</span>, <span class="st">'latitude'</span>]] <span class="co"># select variables</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Output table in html format (hide row nums; format coordinates to their precision of 1 decimal place)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>tbl <span class="op">=</span> tbl.style.hide(axis <span class="op">=</span> <span class="st">'index'</span>).<span class="bu">format</span>(precision<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell scroll_box_y">
<div class="cell-output-display">
<style type="text/css">
</style>

<div id="tbl-detections" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;1: Loggerhead Sea Turtle detections (Strydom, 2022)</caption>
<thead>
<tr class="header">
<th>date</th>
<th>time</th>
<th>longitude</th>
<th>latitude</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2021-12-21</td>
<td>17:57</td>
<td>152.5</td>
<td>-24.5</td>
</tr>
<tr class="even">
<td>2022-01-02</td>
<td>21:49</td>
<td>153.5</td>
<td>-25.5</td>
</tr>
<tr class="odd">
<td>2022-01-05</td>
<td>07:33</td>
<td>152.5</td>
<td>-23.5</td>
</tr>
<tr class="even">
<td>2022-01-06</td>
<td>05:03</td>
<td>151.5</td>
<td>-23.5</td>
</tr>
<tr class="odd">
<td>2022-01-09</td>
<td>20:25</td>
<td>151.5</td>
<td>-22.5</td>
</tr>
<tr class="even">
<td>2022-01-13</td>
<td>06:28</td>
<td>151.5</td>
<td>-21.5</td>
</tr>
<tr class="odd">
<td>2022-01-14</td>
<td>18:26</td>
<td>150.5</td>
<td>-21.5</td>
</tr>
<tr class="even">
<td>2022-01-17</td>
<td>17:06</td>
<td>150.5</td>
<td>-20.5</td>
</tr>
<tr class="odd">
<td>2022-01-19</td>
<td>17:44</td>
<td>149.5</td>
<td>-20.5</td>
</tr>
<tr class="even">
<td>2022-01-21</td>
<td>07:22</td>
<td>149.5</td>
<td>-19.5</td>
</tr>
<tr class="odd">
<td>2022-01-23</td>
<td>07:02</td>
<td>148.5</td>
<td>-19.5</td>
</tr>
<tr class="even">
<td>2022-01-27</td>
<td>17:00</td>
<td>147.5</td>
<td>-18.5</td>
</tr>
<tr class="odd">
<td>2022-01-30</td>
<td>17:02</td>
<td>146.5</td>
<td>-18.5</td>
</tr>
<tr class="even">
<td>2022-02-02</td>
<td>09:14</td>
<td>146.5</td>
<td>-17.5</td>
</tr>
<tr class="odd">
<td>2022-02-03</td>
<td>21:37</td>
<td>153.5</td>
<td>-24.5</td>
</tr>
<tr class="even">
<td>2022-02-06</td>
<td>18:25</td>
<td>146.5</td>
<td>-16.5</td>
</tr>
<tr class="odd">
<td>2022-02-07</td>
<td>07:15</td>
<td>145.5</td>
<td>-16.5</td>
</tr>
<tr class="even">
<td>2022-02-09</td>
<td>18:33</td>
<td>145.5</td>
<td>-15.5</td>
</tr>
<tr class="odd">
<td>2022-02-12</td>
<td>08:59</td>
<td>153.5</td>
<td>-26.5</td>
</tr>
<tr class="even">
<td>2022-02-12</td>
<td>10:34</td>
<td>145.5</td>
<td>-14.5</td>
</tr>
<tr class="odd">
<td>2022-03-25</td>
<td>07:10</td>
<td>144.5</td>
<td>-13.5</td>
</tr>
<tr class="even">
<td>2022-04-01</td>
<td>18:41</td>
<td>143.5</td>
<td>-12.5</td>
</tr>
<tr class="odd">
<td>2022-04-09</td>
<td>22:00</td>
<td>143.5</td>
<td>-11.5</td>
</tr>
<tr class="even">
<td>2022-04-14</td>
<td>06:31</td>
<td>143.5</td>
<td>-10.5</td>
</tr>
<tr class="odd">
<td>2022-04-21</td>
<td>10:30</td>
<td>143.5</td>
<td>-9.5</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p><br></p>
<p>We will take advantage of the consistent file naming on the server to extract the data of interest programatically. We will first need to copy the OPeNDAP data link for one of the files within the correct model and aggregation folders and then replace the date.</p>
<p>Selecting a random date within the daily aggregated data (<code>daily-daily</code>; one data file per day) for the 1km hydro model (<code>gbr1_2.0</code>), we see the files have the naming format:</p>
<p><code>https://thredds.ereefs.aims.gov.au/thredds/dodsC/s3://aims-ereefs-public-prod/derived/ncaggregate/ereefs/gbr1_2.0/daily-daily/EREEFS_AIMS-CSIRO_gbr1_2.0_hydro_daily-daily-</code><span style="color: red">YYYY-MM-DD</span><code>.nc</code></p>
<p>We will now write a script which extracts the data for the dates and coordinates in <a href="#tbl-detections">Table&nbsp;1</a>. For each unique date we will open the corresponding file on the server and extract the daily mean temperature, salinity, northward and southward current velocities for each set of coordinates corresponding to the date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GET DATA FOR EACH DATE AND COORDINATE (LAT LON) PAIR</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>t_start <span class="op">=</span> dt.datetime.now() <span class="co"># to track run time of extraction</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">## 1. Setup variables for data extraction</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Server file name = &lt;file_prefix&gt;&lt;date (yyyy-mm-dd)&gt;&lt;file_suffix&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>file_prefix <span class="op">=</span> <span class="st">"https://thredds.ereefs.aims.gov.au/thredds/dodsC/s3://aims-ereefs-public-prod/derived/ncaggregate/ereefs/gbr1_2.0/daily-daily/EREEFS_AIMS-CSIRO_gbr1_2.0_hydro_daily-daily-"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>file_suffix <span class="op">=</span> <span class="st">".nc"</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Table of dates and coordinates for which to extract data (dates as character string)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>detections <span class="op">=</span> data[[<span class="st">'date'</span>, <span class="st">'longitude'</span>, <span class="st">'latitude'</span>]].drop_duplicates()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>extracted_data <span class="op">=</span> pd.DataFrame() <span class="co"># to save the extracted data</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> detections[<span class="st">'date'</span>].unique() <span class="co"># unique dates for which to open server files</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">## 2. For each date of interest, open a connection to the corresponding data file on the server</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dates)):</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  date_i <span class="op">=</span> dates[i]</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Open file</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  file_name_i <span class="op">=</span> file_prefix <span class="op">+</span> dates[i] <span class="op">+</span> file_suffix</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  server_file_i <span class="op">=</span> Dataset(file_name_i)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Coordinates for which to extract data for the current date</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  coordinates_i <span class="op">=</span> detections.query(<span class="st">"date == @date_i"</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get all coordinates in the open file (each representing the center-point of the corresponding grid cell)</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  server_lons_i <span class="op">=</span> server_file_i.variables[<span class="st">'longitude'</span>][:]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  server_lats_i <span class="op">=</span> server_file_i.variables[<span class="st">'latitude'</span>][:]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">## 3. For each coordinate (lon, lat) for the current date, get the data for the closest grid cell (1km^2) from the open server file</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> row_j <span class="kw">in</span> coordinates_i.itertuples():</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Current coordinate of interest</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    lon_j <span class="op">=</span> row_j.longitude</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    lat_j <span class="op">=</span> row_j.latitude</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the index of the grid cell containing our coordinate of interest (i.e. the center-point closest to our point of interest)</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    lon_index_j <span class="op">=</span> np.argmin(np.<span class="bu">abs</span>(server_lons_i <span class="op">-</span> lon_j))</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    lat_index_j <span class="op">=</span> np.argmin(np.<span class="bu">abs</span>(server_lats_i <span class="op">-</span> lat_j))</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note: This will return the closest grid cell, even for coordinates outside of the eReefs model boundary</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Setup the dimension indices for which to extract data (needs to be a tuple; recall that python starts counting at 0 🤦)</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    dim_ind <span class="op">=</span> <span class="bu">tuple</span>([<span class="dv">0</span>, <span class="dv">15</span>, lat_index_j, lon_index_j])</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">######################################## </span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recall the order of the dimensions (time, k, latitude, longitude) from the previous tutorial. Therefore we want [time = 1 (as we're using the daily files this is the only option), k = 15 corresponding to a depth of 0.5m, lat_index_j, lon_index_j]. If you are still confused, go back to the previous tutorial or have a look at the structure of one of the server files by uncommenting the following 5 lines of code:</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># not_yet_run = True  # used so the following lines are only run once</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if not_yet_run: </span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   print(server_file_i.dimensions)</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   print(server_file_i.variables)</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   not_yet_run = False</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">########################################</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the data for the grid cell containing our point of interest</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    temp_j <span class="op">=</span> server_file_i.variables[<span class="st">'temp'</span>][dim_ind]</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    salt_j <span class="op">=</span> server_file_i.variables[<span class="st">'salt'</span>][dim_ind]</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    u_j <span class="op">=</span> server_file_i.variables[<span class="st">'u'</span>][dim_ind]</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    v_j <span class="op">=</span> server_file_i.variables[<span class="st">'v'</span>][dim_ind]</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    extracted_data_j <span class="op">=</span> pd.DataFrame({</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>      <span class="st">'date'</span>: [date_i],</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">'lon'</span>: [lon_j],</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>      <span class="st">'lat'</span>: [lat_j],</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>      <span class="st">'temp'</span>: [temp_j],</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>      <span class="st">'salt'</span>: [salt_j],</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>      <span class="st">'u'</span>: [u_j],</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>      <span class="st">'v'</span>: [v_j]</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">## 4. Save data in memory and repeat for next date-coordinate pair</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    extracted_data <span class="op">=</span> pd.concat([extracted_data, extracted_data_j], ignore_index <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Close connection to open server file and move to the next date</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  server_file_i.close()</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the run time of the extraction</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>t_stop <span class="op">=</span> dt.datetime.now()</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>extract_time <span class="op">=</span> t_stop <span class="op">-</span> t_start</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>extract_mins <span class="op">=</span> <span class="bu">int</span>(extract_time.total_seconds()<span class="op">/</span><span class="dv">60</span>)</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>extract_secs <span class="op">=</span> <span class="bu">int</span>(extract_time.total_seconds() <span class="op">%</span> <span class="dv">60</span>)</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data extracted for"</span>, <span class="bu">len</span>(detections), <span class="st">"points from"</span>, <span class="bu">len</span>(dates), <span class="st">"files. Extraction time:"</span>, extract_mins, <span class="st">"min"</span>, extract_secs, <span class="st">"sec."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-caution">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>In the code above we match the closest eReefs model grid cell to each point in our list of coordinates (i.e.&nbsp;for each tracking detection). This will therefore match grid cells to all the coordinates, even if they are not within the eReefs model boundary. This behaviour may be useful when we have points right along the coastline as the eReefs models have small gaps at many points along the coast (see image below). However, in other cases this behaviour may not be desirable. For example, if we had points down near Sydney they would be matched to the closest eReefs grid cells (somewhere up near Brisbane) and the extracted data would be erroneous.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/ereefs_model_boundary_and_grid_cells.jpeg"><img src="images/ereefs_model_boundary_and_grid_cells.jpeg" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Our extracted data is shown below <span class="cf">in</span> <span class="sc">@</span>tbl<span class="sc">-</span>extracted<span class="sc">-</span>data. To get this data we openned <span class="st">`</span><span class="at">r length(dates)</span><span class="st">`</span> files on the <span class="fu">server</span> (corresponding to unique dates <span class="cf">in</span> <span class="sc">@</span>tbl<span class="sc">-</span>detections) and extracted data <span class="cf">for</span> <span class="st">`</span><span class="at">r nrow(detections)</span><span class="st">`</span> unique date<span class="sc">-</span>coordinate pairs. On our machine this took <span class="st">`</span><span class="at">r paste(round(as.numeric(extract_time), 1), units(extract_time))</span><span class="st">`</span> to run.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the extracted data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>extracted_data <span class="sc">|&gt;</span> <span class="fu">kable</span>() <span class="sc">|&gt;</span> <span class="fu">kable_styling</span>() <span class="sc">|&gt;</span> <span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">"300px"</span>, <span class="at">fixed_thead =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-extracted-data" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Extracted daily mean temperature, salinity, and east- and northward current velocities (u, v respectively) for Loggerhead Sea Turtle detections (Strydom, 2022)">
<div class="panel-caption table-caption">
<p><strong>?(caption)</strong></p>
</div>
</div>
</div>
</section>
<section id="matching-extracted-data-to-tracking-data" class="level2">
<h2 class="anchored" data-anchor-id="matching-extracted-data-to-tracking-data">Matching extracted data to tracking data</h2>
<p>We will match up the eReefs data with our tracking detections by combining the two datasets based on common date, longitude and latitude values.</p>
<div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure common variables date, lon and lat between the two datasets</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>extracted_data <span class="ot">&lt;-</span> extracted_data <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">longitude =</span> lon, <span class="at">latitude =</span> lat)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>loggerhead_data <span class="ot">&lt;-</span> loggerhead_data <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as_date</span>(date_time))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the two datasets based on common date, lon and lat values</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  loggerhead_data, extracted_data, </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>date)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined data</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>combined_data <span class="sc">|&gt;</span> <span class="fu">kable</span>() <span class="sc">|&gt;</span> <span class="fu">kable_styling</span>() <span class="sc">|&gt;</span>  <span class="fu">scroll_box</span>(<span class="at">height =</span> <span class="st">"300px"</span>, <span class="at">fixed_thead =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-combined-data" class="cell tbl-parent quarto-layout-panel anchored" data-tbl-cap="Loggerhead Sea Turtle tracking detections (Strydom, 2022) and corresponding eReefs daily mean temperature, salinity, east- and northward current velocities (u, v respectively).">
<div class="panel-caption table-caption">
<p><strong>?(caption)</strong></p>
</div>
</div>
</div>
<p>Hooray! We now have our combined dataset of the Loggerhead Sea Turtle tracking detections and the corresponding eReefs daily aggregated data (<strong>?@tbl-combined-data</strong>).</p>
<p><br><br><br><br><br><br><br><br><br><br><br>Strydom A. 2022. Wreck Rock Turtle Care - satellite tracking. Data downloaded from <a href="http://seamap.env.duke.edu/dataset/2178">OBIS-SEAMAP</a>; originated from <a href="http://www.seaturtle.org/tracking/index.shtml?project_id=1381">Satellite Tracking and Analysis Tool (STAT)</a>. <a href="https://doi.org/10.15468/k4s6ap">DOI: 10.15468/k4s6ap</a> accessed via <a href="https://www.gbif.org/">GBIF.org</a> on 2023-02-17.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>